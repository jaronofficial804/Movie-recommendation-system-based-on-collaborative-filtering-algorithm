{% extends "base.html" %}
{% block content %}
<div class="chat-center-wrap">
    <div class="chat-center-title">消息中心</div>
    <div class="chat-msg-list" id="chat-msg-list">
        {% for m in inbox|reverse %}
        <div class="chat-msg-item {% if m.sender_id==user_id|string %} self {% else %} other {% endif %}">
            <div class="chat-avatar">
                {% if m.sender_id==user_id|string %}
                    <img src="https://cdn-icons-png.flaticon.com/512/149/149071.png" alt="我">
                {% elif m.sender_id=='admin' %}
                    <img src="https://cdn-icons-png.flaticon.com/512/4712/4712037.png" alt="管理员">
                {% else %}
                    <img src="https://cdn-icons-png.flaticon.com/512/1946/1946429.png" alt="用户">
                {% endif %}
            </div>
            <div class="chat-main">
                <div class="chat-meta">
                    <span class="chat-name">
                        {% if m.sender_id==user_id|string %}我
                        {% elif m.sender_id=='admin' %}管理员
                        {% else %}用户{{ m.sender_id }}
                        {% endif %}
                    </span>
                    <span class="chat-time">{{ m.create_time }}</span>
                    {% if m.is_read and m.receiver_id==user_id|string %}
                        <span class="chat-status">已读</span>
                    {% elif m.receiver_id==user_id|string %}
                        <span class="chat-status unread">未读</span>
                    {% endif %}
                </div>
                <div class="chat-bubble
                    {% if m.type=='feedback' %} feedback
                    {% elif m.type=='notice' %} notice
                    {% endif %}">
                    {{ m.content }}
                </div>
            </div>
        </div>
        {% endfor %}
        {% if inbox|length == 0 %}
        <div style="text-align:center;color:#bbb;margin:28px 0 0 0;">暂无消息</div>
        {% endif %}
    </div>
    <form class="chat-send-bar" method="post" autocomplete="off">
        <textarea name="content" placeholder="填写您的反馈或建议..." rows="1" required class="chat-textarea" id="chat-textarea"
            oninput="autoResize(this)" maxlength="500"></textarea>
        <button class="chat-send-btn" type="submit">发送</button>
    </form>
</div>

<style>
.chat-center-wrap {
    max-width: 520px;
    min-height: 480px;
    margin: 48px auto 0 auto;
    background: rgba(24,28,44,0.78);
    border-radius: 22px;
    box-shadow: 0 8px 36px #1a233944, 0 2px 12px #1d273842;
    position: relative;
    display: flex;
    flex-direction: column;
    height: 70vh;
    backdrop-filter: blur(18px);
    border: 1.5px solid rgba(255,255,255,0.10);
}
.chat-center-title {
    font-size: 1.5em;
    color: #fff;
    font-weight: bold;
    letter-spacing: 2px;
    text-align: center;
    padding: 22px 0 12px 0;
    border-bottom: 1.5px solid #33405e;
    background: transparent;
    border-radius: 22px 22px 0 0;
    margin-bottom: 0;
}
.chat-msg-list {
    flex: 1 1 auto;
    overflow-y: auto;
    padding: 25px 16px 14px 16px;
    display: flex;
    flex-direction: column;
    gap: 13px;
}
.chat-msg-item {
    display: flex;
    align-items: flex-end;
    gap: 13px;
    margin-bottom: 3px;
}
.chat-msg-item.self {
    flex-direction: row-reverse;
}
.chat-avatar img {
    width: 40px; height: 40px;
    border-radius: 50%;
    box-shadow: 0 1.5px 10px #2133553c;
    background: #1e2537;
}
.chat-main {max-width: 74vw;}
.chat-meta {
    font-size: 0.98em;
    color: #95b5dc;
    margin-bottom: 3px;
    display: flex;
    align-items: center;
    gap: 8px;
}
.chat-name {
    color:#7fb8fc;
    font-weight:600;
}
.chat-time {
    color:#4f6787;
    font-size:0.95em;
}
.chat-status {
    font-size: 0.95em;
    margin-left:6px;
    color: #5de38f;
}
.chat-status.unread {
    color: #ffd060;
    font-weight: bold;
}
.chat-bubble {
    padding: 13px 20px;
    border-radius: 16px;
    font-size: 1.13em;
    word-break: break-all;
    background: rgba(42,51,76,0.95);
    color: #fff;
    box-shadow:0 2px 12px #252c3c1c;
    margin-bottom: 2px;
    display: inline-block;
    transition: background 0.2s;
}
.chat-msg-item.self .chat-bubble {
    background: linear-gradient(98deg,#2ad4ff 20%,#3b9ded 100%);
    color: #fff;
    border-bottom-right-radius:6px;
    border-top-right-radius:19px;
    box-shadow: 0 4px 16px #1997ec38;
}
.chat-msg-item.other .chat-bubble {
    background: linear-gradient(94deg,#22283b 80%,#2e3756 100%);
    color: #fff;
    border-bottom-left-radius:6px;
    border-top-left-radius:19px;
    box-shadow: 0 2px 9px #23324b18;
}
.chat-bubble.feedback {
    border-left:4px solid #47a3f3;
}
.chat-bubble.notice {
    border-left:4px solid #ffb347;
}
.chat-send-bar {
    width: 100%;
    min-height: 64px;
    background: rgba(33,36,50,0.93);
    display: flex;
    gap: 14px;
    align-items: flex-end;
    border-top: 1.5px solid #374b6c;
    border-radius: 0 0 22px 22px;
    padding: 15px 20px 15px 20px;
    box-sizing: border-box;
    position: relative;
}
.chat-textarea {
    flex: 1 1 auto;
    border-radius: 13px;
    border: 1.5px solid #457dc9;
    font-size: 1.15em;
    padding: 10px 16px;
    min-height: 36px;
    max-height: 112px;
    resize: none;
    outline: none;
    box-shadow: 0 1px 4px #28396232;
    transition: border 0.18s;
    background: rgba(42,51,76,0.95);
    color: #fff;
}
.chat-textarea:focus {
    border-color: #4cc9f0;
    background: #273555;
}
.chat-send-btn {
    background: linear-gradient(90deg,#4cc9f0 0%,#4361ee 100%);
    color: #fff;
    border: none;
    border-radius: 11px;
    padding: 10px 26px;
    font-size: 1.13em;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 2px 10px #3b90d833;
    transition: background 0.2s, transform 0.1s;
    margin-bottom: 2px;
}
.chat-send-btn:hover {
    background: linear-gradient(95deg,#3ca9e7 10%,#36d1c4 90%);
    transform: scale(1.04);
}

@media (max-width:650px) {
    .chat-center-wrap {max-width:98vw;min-height:420px;}
    .chat-main {max-width: 94vw;}
    .chat-send-bar {padding:10px 7px;}
    .chat-center-title {padding:15px 0 10px 0;}
}

/* Chrome/Safari/Edge 滚动条美化 */
::-webkit-scrollbar {
    width: 11px;
    background: rgba(36,40,56,0.22);  /* 轨道底色半透明深色 */
    border-radius: 8px;
}
::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, #28304a 55%, #3d4461 100%);
    border-radius: 8px;
    border: 2px solid rgba(36,40,56,0.14);  /* 轨道边缘阴影 */
}
::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(135deg, #4cc9f0 10%, #4361ee 90%);
}
/* 滚动条按钮（可选美化） */
::-webkit-scrollbar-button {
    display: none;
}
/* 滚动条轨道 */
::-webkit-scrollbar-track {
    background: rgba(28,34,52,0.19);
    border-radius: 8px;
}

/* Firefox 滚动条美化 */
html, body, * {
    scrollbar-width: thin;
    scrollbar-color: #3d4461 rgba(36,40,56,0.19);
}
</style>

<script>
function autoResize(textarea){
    textarea.style.height = "auto";
    textarea.style.height = Math.min(textarea.scrollHeight, 112) + "px";
}
window.onload = function(){
    // 自动滚到底部
    let msgBox = document.getElementById('chat-msg-list');
    msgBox.scrollTop = msgBox.scrollHeight;
}
</script>
{% endblock %}
